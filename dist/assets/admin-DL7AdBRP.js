import{r,g as x,f as j,i as p,a as f,j as e,d as N,s as u,e as v,u as k,b,R as y,c as w}from"./auth-CJmH0M-c.js";function S({children:l}){const[o,a]=r.useState(!1),[h,i]=r.useState("");return r.useEffect(()=>{const t=m=>{console.error("ErrorBoundary caught an error:",m.message),a(!0),i(m.message)};return window.addEventListener("error",t),()=>window.removeEventListener("error",t)},[]),o?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Something went wrong"}),e.jsx("p",{children:h}),e.jsxs("p",{children:["Please try refreshing the page or ",e.jsx("a",{href:"login.html",className:"text-blue-600",children:"log in again"}),"."]})]}):l}function A(){const[l,o]=r.useState(null),[a,h]=r.useState(!0),[i,t]=r.useState(""),[m,s]=r.useState("");r.useEffect(()=>{console.log("AdminPortal useEffect triggered");const d=x();if(!d){console.error("No token found, redirecting to login"),window.location.href="login.html";return}n(d)},[]);const n=async d=>{try{const g=await j(d);if(!p(g)){console.error("User is not an admin, redirecting to login"),t("Access denied. Admins only."),f(),localStorage.removeItem("userId"),localStorage.removeItem("email"),setTimeout(()=>{window.location.href="login.html"},2e3);return}o(g),localStorage.setItem("userId",g._id),localStorage.setItem("email",g.email)}catch(g){console.error("Profile fetch error:",g.message),t("Session expired. Please log in again."),f(),localStorage.removeItem("userId"),localStorage.removeItem("email"),setTimeout(()=>{window.location.href="login.html"},2e3)}finally{h(!1)}},c=()=>{console.log("Logging out admin"),f(),localStorage.removeItem("userId"),localStorage.removeItem("email"),window.location.href="login.html"};return a?e.jsx("div",{className:"text-center p-4",children:e.jsx("p",{children:"Loading..."})}):i||!l?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Authentication Error"}),e.jsx("p",{children:i||"No user data loaded."}),e.jsxs("p",{children:["Please ",e.jsx("a",{href:"login.html",className:"text-blue-600",children:"log in again"}),"."]})]}):e.jsx(S,{children:e.jsxs("div",{children:[e.jsx("section",{className:"hero-section",children:e.jsxs("header",{className:"container mx-auto flex justify-between items-center",children:[e.jsxs("div",{className:"logo",children:["A & K Analytics",e.jsx("span",{children:"Admin Portal"})]}),e.jsx("nav",{children:e.jsxs("ul",{className:"flex space-x-4",children:[e.jsx("li",{children:e.jsx("a",{href:"index.html",className:"nav-link",children:"Home"})}),e.jsx("li",{children:e.jsx("a",{href:"#",onClick:c,className:"nav-link",children:"Logout"})})]})})]})}),e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("h1",{className:"text-3xl font-bold mb-6",children:["Welcome, Admin ",(l==null?void 0:l.name)||"User","!"]}),i&&e.jsx("div",{className:"error block",children:i}),m&&e.jsx("div",{className:"success block",children:m}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(E,{setSuccess:s,setError:t}),e.jsx(I,{setSuccess:s,setError:t})]})]}),e.jsx("footer",{className:"footer-section",children:e.jsxs("div",{className:"footer-content container mx-auto",children:[e.jsxs("div",{className:"footer-logo",children:["A & K Analytics",e.jsx("span",{children:"Admin Portal"})]}),e.jsx("nav",{className:"footer-nav",children:e.jsxs("ul",{className:"flex flex-wrap",children:[e.jsx("li",{children:e.jsx("a",{href:"about.html",children:"About"})}),e.jsx("li",{children:e.jsx("a",{href:"industries.html",children:"Industries"})}),e.jsx("li",{children:e.jsx("a",{href:"insights.html",children:"Insights"})}),e.jsx("li",{children:e.jsx("a",{href:"index.html#contact",children:"Contact"})})]})}),e.jsx("div",{className:"footer-copyright",children:e.jsx("p",{children:"Â© 2025 A & K Analytics. All rights reserved."})})]})})]})})}function E({setSuccess:l,setError:o}){const[a,h]=r.useState([]),[i,t]=r.useState(!0);r.useEffect(()=>{console.log("UserManagement useEffect triggered");const s=x();N(s).then(n=>h(n)).catch(n=>{console.error("Users fetch error:",n.message),o("Failed to load users.")}).finally(()=>t(!1))},[o]);const m=async(s,n)=>{try{const c=x();await k(c,s,n),h(a.map(d=>d._id===s?{...d,role:n}:d)),l("User role updated successfully."),o("")}catch(c){console.error("Role update error:",c.message),o("Failed to update user role.")}};return i?e.jsx("div",{className:"card",children:e.jsx("p",{children:"Loading users..."})}):e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"User Management"}),a.length?e.jsx("ul",{className:"space-y-2",children:a.map(s=>e.jsxs("li",{className:"border-b py-2 flex justify-between items-center",children:[e.jsxs("p",{children:[u(s.email)," - ",u(s.name)]}),e.jsxs("select",{value:s.role,onChange:n=>m(s._id,n.target.value),className:"p-2 border rounded",children:[e.jsx("option",{value:"user",children:"User"}),e.jsx("option",{value:"admin",children:"Admin"})]})]},s._id))}):e.jsx("p",{children:"No users found."})]})}function I({setSuccess:l,setError:o}){const[a,h]=r.useState([]),[i,t]=r.useState(!0);r.useEffect(()=>{console.log("BookingManagement useEffect triggered");const s=x();v(s).then(n=>h(n)).catch(n=>{console.error("Bookings fetch error:",n.message),o("Failed to load bookings.")}).finally(()=>t(!1))},[o]);const m=async s=>{var n;if(window.confirm("Cancel this booking?"))try{const c=x();await b.delete(`https://a-k-analytics-backend.onrender.com/api/admin/bookings/${s}`,{headers:{Authorization:`Bearer ${c}`}}),h(a.filter(d=>d._id!==s)),l("Booking cancelled."),o("")}catch(c){console.error("Cancel booking error:",((n=c.response)==null?void 0:n.data)||c.message),o("Failed to cancel booking.")}};return i?e.jsx("div",{className:"card",children:e.jsx("p",{children:"Loading bookings..."})}):e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Booking Management"}),a.length?e.jsx("ul",{className:"space-y-2",children:a.map(s=>e.jsxs("li",{className:"border-b py-2 flex justify-between items-center",children:[e.jsxs("p",{children:[u(s.service)," - ",u(s.userEmail)," - ",new Date(s.callTime).toLocaleString()]}),e.jsx("button",{onClick:()=>m(s._id),className:"action-btn cancel-btn",children:"Cancel"})]},s._id))}):e.jsx("p",{children:"No bookings found."})]})}y.createRoot(document.getElementById("root")).render(e.jsx(w.StrictMode,{children:e.jsx(A,{})}));
